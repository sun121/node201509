{"version":3,"sources":["server.js"],"names":[],"mappings":";;AAAA,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC3B,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC3B,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC3B,IAAI,GAAG,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC;AACzB,IAAI,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AACvB,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC3B,IAAK,UAAU,GAAI,OAAO,CAAC,YAAY,CAAC,CAAC;AACzC,IAAI,WAAW,GAAG,OAAO,CAAC,aAAa,CAAC,CAAC;AACzC,IAAI,YAAY,GAAG,CAAC,CAAC;AACrB,IAAI,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,UAAS,GAAG,EAAC,GAAG,EAAC;AACzC,QAAI,MAAM,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,EAAC,IAAI,CAAC,CAAC;AACrC,QAAI,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC;AAC/B,QAAG,QAAQ,IAAE,GAAG,EAAC;AACb,UAAE,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACjD,MAAK,IAAG,QAAQ,IAAE,OAAO,EAAC;AACzB,YAAI,MAAM,GAAG,IAAI,UAAU,CAAC,YAAY,EAAE,CAAC;AACzC,cAAM,CAAC,KAAK,CAAC,GAAG,EAAC,UAAS,GAAG,EAAC,MAAM,EAAC,KAAK,EAAC;AACxC,gBAAI,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC;AAC3B,gBAAI,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;AACzB,gBAAI,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;AACzB,gBAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;;AAEvB,gBAAI,GAAG,GAAG,EAAE,CAAC,gBAAgB,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC/C,gBAAI,MAAM,GAAG,EAAE,CAAC,iBAAiB,CAAC,QAAQ,GAAC,GAAG,GAAC,KAAK,CAAC,CAAC;AACtD,kBAAM,CAAC,EAAE,CAAC,OAAO,EAAC,YAAU;AACxB,uBAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AACnB,oBAAG,YAAY,IAAI,KAAK,GAAE,CAAC,EAAC;;AAEzB,wBAAI,KAAK,GAAG,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;AAChC,yBAAK,CAAC,OAAO,CAAC,UAAS,IAAI,EAAC;AACxB,4BAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,GAAC,GAAG,CAAC,EAAC;AAC7B,gCAAI,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,CAAA,GAAE,IAAI,CAAC;;;;;AAKvD,8BAAE,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,iBAAiB,CAAC,QAAQ,EAAC,EAAC,KAAK,EAAC,GAAG,EAAC,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;AACvF,8BAAE,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;yBACvB;qBACJ,CAAC,CAAC;;AAEF,gCAAY,GAAG,CAAC,CAAC;iBACpB,MAAI;AACD,gCAAY,EAAE,CAAC;iBAClB;aACJ,CAAC,CAAC;AACF,eAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AAClB,eAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;SAChB,CAAC,CAAC;KACN,MAAI;AACD,WAAG,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;KAClB;CACJ,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC","file":"server-compiled.js","sourcesContent":["var mime = require('mime');\r\nvar http = require('http');\r\nvar util = require('util');\r\nvar url = require('url');\r\nvar fs = require('fs');\r\nvar path = require('path');\r\nvar  formidable  = require('formidable');\r\nvar querystring = require('querystring');\r\nvar successCount = 0;\r\nvar app = http.createServer(function(req,res){\r\n    var urlObj = url.parse(req.url,true);\r\n    var pathname = urlObj.pathname;\r\n    if(pathname=='/'){\r\n        fs.createReadStream('./index.html').pipe(res);\r\n    }else if(pathname=='/post'){\r\n      var parser = new formidable.IncomingForm();\r\n        parser.parse(req,function(err,fields,files){\r\n           var filename = fields.name;\r\n           var total = fields.total;\r\n           var index = fields.index;\r\n           var size = fields.size;\r\n\r\n           var src = fs.createReadStream(files.data.path);\r\n           var target = fs.createWriteStream(filename+'.'+index);\r\n           target.on('close',function(){\r\n               console.log(index);\r\n               if(successCount == total -1){\r\n                  //var fd = fs.openSync(filename,'a');\r\n                  var files = fs.readdirSync('.');\r\n                  files.forEach(function(file){\r\n                      if(file.startsWith(filename+'.')){\r\n                          var pos = (Number(path.extname(file).slice(1))-1)*size;\r\n                          /*var buff = fs.readFileSync(file);\r\n                          console.log('fd',fd,buff.length,pos);\r\n                         fs.writeSync(fd,buff,0,buff.length,pos);\r\n                          fs.unlinkSync(file);*/\r\n                          fs.createReadStream(file).pipe(fs.createWriteStream(filename,{start:pos,flags: 'a',}));\r\n                          fs.unlinkSync(file);\r\n                      }\r\n                  });\r\n                   //fs.closeSync(fd);\r\n                   successCount = 0;\r\n               }else{\r\n                   successCount++;\r\n               }\r\n           });\r\n            src.pipe(target);\r\n           res.end('ok');\r\n        });\r\n    }else{\r\n        res.end('404');\r\n    }\r\n}).listen(8080);"]}