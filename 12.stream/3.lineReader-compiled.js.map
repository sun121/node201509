{"version":3,"sources":["3.lineReader.js"],"names":[],"mappings":";;AAAA,IAAI,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AACvB,IAAI,YAAY,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC,YAAY,CAAC;AAClD,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;;;;AAI3B,IAAI,MAAM,GAAE,IAAI,CAAC;AACjB,IAAI,OAAO,GAAG,IAAI,CAAC;;AAEnB,SAAS,UAAU,CAAC,IAAI,EAAC;AACrB,QAAI,CAAC,GAAG,GAAG,EAAE,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;CACxC;AACD,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAC,YAAY,CAAC,CAAC;;AAEvC,UAAU,CAAC,SAAS,CAAC,EAAE,CAAC,aAAa,EAAC,UAAS,IAAI,EAAC,IAAI,EAAC;AACrD,QAAI,IAAI,GAAC,IAAI,CAAC;AACd,QAAI,QAAQ,CAAC;AACb,QAAI,EAAE,GAAC,KAAK,CAAC;AACb,QAAI,OAAO,GAAC,EAAE,CAAC;AACf,QAAG,IAAI,KAAK,SAAS,EAAC;AAClB,YAAI,CAAC,GAAG,CAAC,EAAE,CAAC,UAAU,EAAC,UAAS,IAAI,EAAC;AACjC,gBAAI,IAAI,CAAC;AACT,gBAAI,OAAO,GAAC,EAAE,CAAC;AACf,mBAAM,IAAI,KAAG,IAAI,GAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAA,AAAC,EAAC;AAC/B,qBAAI,IAAI,CAAC,GAAC,CAAC,EAAC,CAAC,GAAC,IAAI,CAAC,MAAM,EAAC,CAAC,EAAE,EAAC;AAC1B,wBAAG,EAAE,EAAC;AACF,4BAAG,IAAI,CAAC,CAAC,CAAC,KAAK,OAAO,EAAC;AACnB,gCAAI,GAAG,GAAC,IAAI,MAAM,CAAC,OAAO,CAAC,CAAC;AAC5B,gCAAG,GAAG,CAAC,MAAM,GAAC,CAAC,EAAC;AACZ,oCAAI,CAAC,IAAI,CAAC,SAAS,EAAC,GAAG,CAAC,CAAA;6BAC3B;AACD,mCAAO,GAAC,EAAE,CAAA;AACV,8BAAE,GAAC,KAAK,CAAC;yBACZ;qBACJ,MAAK,IAAG,IAAI,CAAC,CAAC,CAAC,KAAK,MAAM,EAAC;AACxB,0BAAE,GAAC,IAAI,CAAC;qBACX,MACC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAA;iBAC1B;AACD,oBAAI,GAAG,GAAC,IAAI,MAAM,CAAC,OAAO,CAAC,CAAC;AAC5B,oBAAG,GAAG,CAAC,MAAM,GAAC,CAAC,EAAC;AACZ,wBAAI,CAAC,IAAI,CAAC,SAAS,EAAC,GAAG,CAAC,CAAA;iBAC3B;aACJ;SAGJ,CAAC,CAAA;KACL;AACD,QAAG,IAAI,KAAK,KAAK,EAAC;AACd,YAAI,CAAC,GAAG,CAAC,EAAE,CAAC,KAAK,EAAC,YAAU;AACxB,gBAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;SACnB,CAAC,CAAA;KACL;CAEJ,CAAC,CAAC;;AAEH,IAAI,MAAM,GAAG,IAAI,UAAU,CAAC,YAAY,CAAC,CAAC;AAC1C,MAAM,CAAC,EAAE,CAAC,SAAS,EAAC,UAAS,IAAI,EAAC;AAC9B,WAAO,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;CAChC,CAAC,CAAC;AACH,MAAM,CAAC,EAAE,CAAC,KAAK,EAAC,YAAU;AACtB,WAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;CACtB,CAAC,CAAC","file":"3.lineReader-compiled.js","sourcesContent":["var fs = require('fs');\r\nvar EventEmitter = require('events').EventEmitter;\r\nvar util = require('util');\r\n///r/n 0x0d 0x0a\r\n// http://baike.baidu.com/link?url=ZwIraTFCTerLt5dqA-DLufYtnzCnwJJVDkyWnU-6zEFq15P7YBOzX4m5Bu4LHtuT_34TPwo9lfaJwpQWuDfMK_\r\n\r\nvar RETURN= 0x0d; // ascii \\r       十六进制的d就等于十进制的13  回车 return 移动光标到该行的起始位置\r\nvar NEWLINE = 0x0a; // ascii  \\n   十六进制的a等于十进制的10 换行 newline 换行至下一行行首起始位置\r\n\r\nfunction LineReader(path){\r\n    this._rs = fs.createReadStream(path);\r\n}\r\nutil.inherits(LineReader,EventEmitter);\r\n\r\nLineReader.prototype.on('newListener',function(name,func){\r\n    var self=this;\r\n    var lineData;\r\n    var ok=false;\r\n    var dataArr=[];\r\n    if(name === \"newLine\"){\r\n        this._rs.on(\"readable\",function(data){\r\n            var data;\r\n            var dataArr=[];\r\n            while(null!=(data=self._rs.read())){\r\n                for(var i=0;i<data.length;i++){\r\n                    if(ok){\r\n                        if(data[i] === NEWLINE){\r\n                            var buf=new Buffer(dataArr);\r\n                            if(buf.length>0){\r\n                                self.emit(\"newLine\",buf)\r\n                            }\r\n                            dataArr=[]\r\n                            ok=false;\r\n                        }\r\n                    }else if(data[i] === RETURN){\r\n                        ok=true;\r\n                    }else\r\n                      dataArr.push(data[i])\r\n                }\r\n                var buf=new Buffer(dataArr);\r\n                if(buf.length>0){\r\n                    self.emit(\"newLine\",buf)\r\n                }\r\n            }\r\n\r\n\r\n        })\r\n    }\r\n    if(name === \"end\"){\r\n        this._rs.on(\"end\",function(){\r\n            self.emit(\"end\")\r\n        })\r\n    }\r\n\r\n});\r\n\r\nvar reader = new LineReader('./read.txt');\r\nreader.on('newLine',function(data){\r\n    console.log(data.toString());\r\n});\r\nreader.on('end',function(){\r\n    console.log('end');\r\n});\r\n"]}